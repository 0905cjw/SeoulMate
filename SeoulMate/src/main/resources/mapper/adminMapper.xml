<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="com.seoulmate.home.dao.AdminDAO">
 	<select id="memberSelect" parameterType="com.seoulmate.home.vo.PagingVO" resultType="com.seoulmate.home.vo.MemberVO">
		select * from (select * from (select * from 
  		(select * from 
  		(select * from 
  		(select no, userid, username, tel, email, grade, reportcnt, state from member 
  		<if test='searchKey !=null and searchWord != null and searchKey != "" and searchWord !=""'>where ${searchKey} like '%${searchWord}%'</if>)
  		<if test="grade != null and grade != 0"> where grade=${grade} </if>)
  		<if test='state != null and state !=""'> where state=#{state}</if>)  
  		order by no desc)
  		where <![CDATA[rownum<=]]>${pageNum * onePageRecode} order by no asc)
  		where <![CDATA[rownum<=]]><if test="pageNum==totalPage">${lastPageRecode}</if> 
  		<if test="pageNum!=totalPage">${onePageRecode}</if> ORDER BY no DESC
  	</select>
  	<select id="memberInfo" resultType="com.seoulmate.home.vo.MemberVO">
  		select profilepic, userid, userpwd, username, to_char(birth, 'YYYY-MM-DD') birth, tel, email, reportcnt, state from member where userid=#{param1}
  	</select>
  	<select id="membertotalRecord" parameterType="com.seoulmate.home.vo.PagingVO" resultType="int">
  		select count(no) no from 
  		(select * from 
  		(select * from member 
  		<if test='searchWord !=null and searchWord != ""'>where ${searchKey} like '%${searchWord}%'</if>)
  		<if test='state !="" and state != null'>where state=#{state}</if>)
  		<if test="grade == 1 or grade == 2">where grade=${grade}</if>
  	</select>
  	<update id="memberInfoSave" parameterType="com.seoulmate.home.vo.MemberVO">
  		update member set profilePic=#{profilePic}, reportcnt=#{reportCnt}, username=#{username}, tel=#{tel}, email=#{email}, 
  		<choose>
  			<when test='state==null'>
  				state='일반'
  			</when>
  			<when test='state=="on"'>
  				state='블랙'
  			</when>
  		</choose>
  		where userid=#{userid} and birth=#{birth}
  	</update>  	
  	
  	
  	<select id="totalRecode" parameterType="com.seoulmate.home.vo.PayVO" resultType="int">
  		select count(no) from pay <if test="searchWord != null">where ${searchKey} like '%${searchWord}%' </if>
  	</select>
  	<select id="payOnePageListSelect" parameterType="com.seoulmate.home.vo.PayVO">
  	
  	</select>
</mapper>